import React, { useState, useEffect } from 'react';
import axios from 'axios';
import SideArrow from './sideArrow.jsx';
import FormModal from './formModal.jsx';
import LogEntry from './logEntry.jsx';

function Comments() {
  const [entries, setEntries] = useState([]);
  const [newSubmission, setNewSubmission] = useState({});
  const [show, setShow] = useState(false);

  function onClick() { setShow(true); }

  useEffect(() => {
    axios.get('/log/entries')
      .then(({ data }) => setEntries(data))
      .catch(() => console.log('failed to get logs'));
  }, []);

  useEffect(() => {
    if (entries.length || newSubmission) setEntries((oldEntries) => [...oldEntries, newSubmission]);
  }, [newSubmission]);

  return (
    <div className="section" id="comments">
      <h2>/* comments */</h2>
      <br/>
      <code>
        //
      </code>
      <br/>
      <code>
        // Share them with me, your thoughts, your ambitions, the principles you would follow.
      </code>
      <br/>
      <code>
        //
      </code>
      <div style={{textAlign: 'center'}}>
        <svg type="button" onClick={onClick} xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="3em" height="3em" viewBox="0 0 50 50">
          <path fill="currentColor" d="M 25.5 2 C 25.413894 3.0025638 25.348799 4.006374 25.273438 5.0097656 A 2.5 2.5 0 0 0 23.171875 6.5878906 C 17.81751 6.2485391 12.665047 4.7465797 9.1015625 2.0859375 C 12.078031 5.9402972 17.508886 8.0928432 23.228516 8.5449219 A 2.5 2.5 0 0 0 24.943359 9.9355469 C 24.826414 11.969471 24.73286 14.005137 24.660156 16.041016 C 20.429172 16.456206 17.114909 19.976308 17.009766 24.291016 C 14.605102 25.792511 13 28.456517 13 31.5 C 13 36.194 16.806 40 21.5 40 C 22.668497 40 23.781493 39.762627 24.794922 39.335938 C 24.90091 41.556455 25.037879 43.774696 25.197266 45.992188 C 21.400582 45.947527 17.611303 45.205571 14.136719 43.765625 C 10.520719 42.240625 7.1938125 39.919094 4.6328125 36.746094 C 6.4938125 40.393094 9.7635625 43.302687 13.476562 45.179688 C 17.054259 47.024601 21.191523 47.940986 25.345703 47.962891 C 25.399384 48.641815 25.441295 49.321467 25.5 50 C 25.558873 49.319526 25.600477 48.637898 25.654297 47.957031 C 34.068647 47.909817 42.502614 44.143004 46.46875 36.587891 C 41.459007 42.851063 33.654117 45.91883 25.804688 45.982422 C 25.963759 43.768212 26.099247 41.553164 26.205078 39.335938 C 27.218507 39.762627 28.331503 40 29.5 40 C 34.194 40 38 36.194 38 31.5 C 38 28.456517 36.394898 25.792511 33.990234 24.291016 C 33.885091 19.976308 30.570828 16.456206 26.339844 16.041016 C 26.267116 14.004452 26.171687 11.9682 26.054688 9.9335938 A 2.5 2.5 0 0 0 27.767578 8.5449219 C 33.540875 8.0961607 39.027537 5.9182864 42 2 C 38.42585 4.7282416 33.226555 6.2537883 27.826172 6.5917969 A 2.5 2.5 0 0 0 25.726562 5.0136719 C 25.651117 4.0089843 25.586217 3.0038577 25.5 2 z M 24.595703 18.050781 C 24.576599 18.720139 24.547514 19.389124 24.533203 20.058594 C 22.10796 20.333635 19.997338 21.63126 18.630859 23.507812 C 18.436662 23.577573 18.243998 23.649216 18.056641 23.732422 C 18.460674 20.762421 21.171421 18.407838 24.595703 18.050781 z M 26.404297 18.050781 C 29.828579 18.407838 32.539326 20.762421 32.943359 23.732422 C 32.756002 23.649216 32.563338 23.577573 32.369141 23.507812 C 31.002662 21.63126 28.89204 20.333635 26.466797 20.058594 C 26.452486 19.389124 26.423401 18.720139 26.404297 18.050781 z M 24.511719 22.0625 C 24.504652 22.559303 24.498563 23.055904 24.494141 23.552734 C 23.565786 23.20265 22.564039 23.001671 21.513672 23 C 22.404875 22.513716 23.420147 22.187266 24.511719 22.0625 z M 26.488281 22.0625 C 27.579853 22.187266 28.595125 22.513716 29.486328 23 C 28.435961 23.001671 27.434214 23.20265 26.505859 23.552734 C 26.501437 23.055904 26.495348 22.559303 26.488281 22.0625 z M 21.5 25 C 22.269624 25 23.011961 25.102431 23.710938 25.289062 C 22.441517 26.472802 21.528503 28.034117 21.169922 29.800781 C 19.864737 28.998455 18.867652 27.847464 18.365234 26.5 C 18.506901 26.120057 18.684341 25.755904 18.900391 25.410156 C 19.711299 25.150051 20.584763 25 21.5 25 z M 29.5 25 C 30.415237 25 31.288701 25.150051 32.099609 25.410156 C 32.315659 25.755904 32.493099 26.120057 32.634766 26.5 C 32.132348 27.847464 31.135263 28.998455 29.830078 29.800781 C 29.471497 28.034117 28.558483 26.472802 27.289062 25.289062 C 27.988039 25.102431 28.730376 25 29.5 25 z M 17.169922 26.199219 C 17.190634 26.301266 17.22176 26.399316 17.246094 26.5 C 17.090814 27.14249 17 27.809842 17 28.5 C 17 32.185494 19.350715 35.31388 22.630859 36.492188 C 22.951597 36.932649 23.313311 37.34015 23.710938 37.710938 C 23.011961 37.897569 22.269624 38 21.5 38 C 17.358 38 14 35.09 14 31.5 C 14 29.309517 15.254284 27.376804 17.169922 26.199219 z M 33.830078 26.199219 C 35.745716 27.376804 37 29.309517 37 31.5 C 37 35.09 33.642 38 29.5 38 C 28.730376 38 27.988039 37.897569 27.289062 37.710938 C 27.686689 37.34015 28.048403 36.932649 28.369141 36.492188 C 31.649285 35.31388 34 32.185494 34 28.5 C 34 27.809842 33.909186 27.14249 33.753906 26.5 C 33.77824 26.399316 33.809366 26.301266 33.830078 26.199219 z M 24.476562 26.683594 C 24.479806 28.101368 24.494702 29.519939 24.519531 30.9375 C 23.67026 30.841207 22.868066 30.622001 22.132812 30.300781 C 22.43992 28.875162 23.28442 27.618009 24.476562 26.683594 z M 26.523438 26.683594 C 27.71558 27.618009 28.56008 28.875162 28.867188 30.300781 C 28.131934 30.622001 27.32974 30.841207 26.480469 30.9375 C 26.505298 29.519939 26.520194 28.101368 26.523438 26.683594 z M 18 28.5 C 18.703775 29.81634 19.74811 30.921194 21.009766 31.708984 C 21.028407 32.473952 21.145546 33.213979 21.353516 33.916016 C 19.332814 32.751523 18 30.760863 18 28.5 z M 33 28.5 C 33 30.760863 31.667186 32.751523 29.646484 33.916016 C 29.854454 33.213979 29.971593 32.473952 29.990234 31.708984 C 31.25189 30.921194 32.296225 29.81634 33 28.5 z M 22.056641 32.267578 C 22.837109 32.614185 23.677488 32.850072 24.560547 32.947266 C 24.577083 33.61605 24.6056 34.284472 24.626953 34.953125 C 24.025962 34.892693 23.449443 34.765957 22.900391 34.589844 C 22.459593 33.884427 22.169853 33.099785 22.056641 32.267578 z M 28.943359 32.267578 C 28.830147 33.099785 28.540407 33.884427 28.099609 34.589844 C 27.550557 34.765957 26.974038 34.892693 26.373047 34.953125 C 26.3944 34.284472 26.422917 33.61605 26.439453 32.947266 C 27.322512 32.850072 28.162891 32.614185 28.943359 32.267578 z" />
        </svg>
        <FormModal show={show} setShow={setShow} setNewSubmission={setNewSubmission} />
      </div>
      <div className="log">
        {(entries.length === 0) && (<>no entries...</>)}
        {entries.map((entry) => <LogEntry name={entry.name} date={entry.date} message={entry.message} /> )}
      </div>
    </div>
  )
}

export default Comments;
